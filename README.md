# grpc-tutorial
Tutorial on how to create a grpc .net service and consume it from vue js

## STEPS

### Service
- create new vs project from grpc template  
![New Project](./images/00_crear_proyecto.png)  
- add new .proto file
- set file properties to compile:  
![Proto file properties](./images/01_propiedades_proto_file.png)
- Include NuGet package Grpc.AspNetCore.Web:
```
NuGet\Install-Package Grpc.AspNetCore.Web -Version 2.49.0
```
- Modify Startup.cs, to allow vue client reach service (CORS, and GRPC communication).

```
public class Startup
{
	// This method gets called by the runtime. Use this method to add services to the container.
	// For more information on how to configure your application, visit https://go.microsoft.com/fwlink/?LinkID=398940
	public void ConfigureServices(IServiceCollection services)
	{
		services.AddGrpc();

		//Add cors
		services.AddCors(o => o.AddPolicy("AllowAll", builder =>
		{
			builder.AllowAnyOrigin()
				   .AllowAnyMethod()
				   .AllowAnyHeader()
				   .WithExposedHeaders("Grpc-Status", "Grpc-Message", "Grpc-Encoding", "Grpc-Accept-Encoding");
		}));
	}

	// This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
	public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
	{
		if (env.IsDevelopment())
		{
			app.UseDeveloperExceptionPage();
		}

		app.UseRouting();

		//Add GrpcWeb
		app.UseGrpcWeb();

		//Add cors
		app.UseCors("AllowAll");

		app.UseEndpoints(endpoints =>
		{
			//before:
			//endpoints.MapGrpcService<TutorialService>();
			
			//after:
			endpoints.MapGrpcService<GreeterService>().EnableGrpcWeb()
				.RequireCors(cors => cors.AllowAnyHeader().AllowAnyMethod().AllowAnyOrigin());

			endpoints.MapGet("/", async context =>
			{
				await context.Response.WriteAsync("Communication with gRPC endpoints must be made through a gRPC client. To learn how to create a client, visit: https://go.microsoft.com/fwlink/?linkid=2086909");
			});
		});
	}
}
```
- Another option is to set up a proxy for docker (Envoy proxy): 
  - https://www.envoyproxy.io/
  - https://github.com/grpc/grpc-web/tree/master/net/grpc/gateway/examples/helloworld#configure-the-proxy

- add httpPort and sslPort to launchSettings.json file, to set fixed values:
```
{
  "profiles": {
    "GrpcTutorial": {
      "commandName": "Project",
      "environmentVariables": {
        "ASPNETCORE_ENVIRONMENT": "Development"
      },
      "applicationUrl": "https://localhost:5001"
    },
    "Docker": {
      "commandName": "Docker",
      "launchUrl": "{Scheme}://{ServiceHost}:{ServicePort}",
      "publishAllPorts": true,
      "httpPort": 51804,
      "useSSL": true,
      "sslPort": 44361
    }
  }
}
```


### Client





### VUE 3

#### Init Vue project
- npm init vue@latest (in powershell or cmd, not in Git Bash)
- cd vue-grpc
- npm install
- npm run lint
- npm run dev

#### Problem --> it seems that for now (2022/11/02) the file generated by protoc is not compatible with the import system of Vue 3.


#### VUE 2
- npm install -g @vue/cli
- put vue path in environment variables, or run:
```  
C:\Users\user.name\AppData\Roaming\npm\vue create vue-grpc
```

### how to install proto
https://www.geeksforgeeks.org/how-to-install-protocol-buffers-on-windows/

1.- download version: 
https://github.com/protocolbuffers/protobuf/releases
2.- paste protoc-21.5-win64 in C:\.
3.- add C:\protoc-21.5-win64-win64 to the system variable Path
4.- $ protoc --version
	libprotoc 3.21.5
5.- download https://github.com/grpc/grpc-web/releases
6.- add to the system variable Path: C:\protoc-web-client (protoc-gen-grpc-web-1.3.1-windows-x86_64.exe)

![Path System Variable](./images/01_propiedades_proto_file.png)

## add dependencies to package.json
```
"google-protobuf": "^3.21.2",
"grpc-web": "^1.3.1",
```

## generate protos
- copy the proto file into vue project
- excecute command: 
```
protoc src/protos/tutorial.proto --js_out=import_style=commonjs:./ --grpc-web_out=import_style=commonjs,mode=grpcwebtext:./

```




### Spring-boot Service
- create new project with initializr, adding spring-web and spring-boot dev tools. pom file looks like this:
```
<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd">
    <modelVersion>4.0.0</modelVersion>
    <parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.7.5</version>
        <relativePath/> <!-- lookup parent from repository -->
    </parent>
    <groupId>com.example</groupId>
    <artifactId>springboot-service</artifactId>
    <version>0.0.1-SNAPSHOT</version>
    <name>springboot-service</name>
    <description>springboot-service</description>
    <properties>
        <java.version>17</java.version>
    </properties>
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-web</artifactId>
        </dependency>

        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
            <scope>runtime</scope>
            <optional>true</optional>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>

    <build>
        <plugins>
            <plugin>
                <groupId>org.springframework.boot</groupId>
                <artifactId>spring-boot-maven-plugin</artifactId>
            </plugin>
        </plugins>
    </build>

</project>
```


## Documentation
### GRPC Service  
- https://docs.microsoft.com/es-es/aspnet/core/tutorials/grpc/grpc-start?view=aspnetcore-3.0&tabs=visual-studio
- https://medium.com/@lukastosic/part-3-grpc-its-fairly-simple-tips-and-tricks-c7017ed9735e
- https://docs.microsoft.com/en-us/visualstudio/containers/container-launch-settings?view=vs-2019

### Vue client  
- https://cli.vuejs.org/guide/creating-a-project.html
- https://www.geeksforgeeks.org/how-to-install-protocol-buffers-on-windows/
- https://medium.com/@aravindhanjay/a-todo-app-using-grpc-web-and-vue-js-4e0c18461a3e
- https://abhinandanaryal.info.np/article/a-complete-walk-through-of-using-grpc-web-using-net-core-server-and-vuejs-client

### Spring-boot openapi service
- (openapi) https://mydeveloperplanet.com/2022/02/08/generate-server-code-using-openapi-generator/
- https://tealfeed.com/develop-rest-apis-openapi-spec-using-ue6jw
